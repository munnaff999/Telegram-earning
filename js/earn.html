<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<header>Earn Coins</header>

<div class="card">
  <button onclick="completeOffer(101)">
    Install App → Earn 1 Coin
  </button>
</div>

<nav>
  <a href="index.html">Home</a>
  <a class="active" href="earn.html">Earn</a>
  <a href="withdraw.html">Withdraw</a>
  <a href="profile.html">Profile</a>
</nav>

<script src="js/init.js"></script>
<script src="js/auth.js"></script>
<script>
async function completeOffer(offer_id) {
  const tgId = localStorage.getItem("telegram_id");

  window.open("https://otieu.com/4/10508140", "_blank");

  const { data: done } = await supabase
    .from("offer_completions")
    .select("id")
    .eq("telegram_id", tgId)
    .eq("offer_id", offer_id)
    .maybeSingle();

  if (done) return alert("Already completed");

  const { data: user } = await supabase
    .from("users")
    .select("id,balance")
    .eq("telegram_id", tgId)
    .single();

  await supabase.from("offer_completions").insert({
    telegram_id: tgId,
    offer_id,
    reward: 1
  });

  await supabase.from("users")
    .update({ balance: user.balance + 1 })
    .eq("id", user.id);

  alert("✅ 1 Coin Added");
}
</script>

</body>
</html>
