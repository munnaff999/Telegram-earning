<!DOCTYPE html>
<html>
<head>
  <title>Earn Coins</title>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

</head>
<body>

<h2>Install Offers</h2>

<button onclick="completeOffer(101)">
  Install App ‚Üí Earn 1 Coin
</button>

<!-- üîΩ YAHAN PASTE KARO -->
<script>
/* SUPABASE INIT (already hona chahiye) */
const supabase = window.supabase.createClient(
  "https://YOUR_PROJECT_ID.supabase.co",
  "YOUR_PUBLIC_ANON_KEY"
);

async function completeOffer(offer_id) {
  const telegram_id = localStorage.getItem("telegram_id");

  if (!telegram_id) {
    alert("Telegram login required");
    return;
  }

  window.open("https://otieu.com/4/10508140", "_blank");

  const { data: alreadyDone } = await supabase
    .from("offer_completions")
    .select("id")
    .eq("telegram_id", telegram_id)
    .eq("offer_id", offer_id)
    .maybeSingle();

  if (alreadyDone) {
    alert("‚ùå Offer already completed");
    return;
  }

  const { data: user } = await supabase
    .from("users")
    .select("id, balance")
    .eq("telegram_id", telegram_id)
    .single();

  if (!user) {
    alert("User not found");
    return;
  }

  await supabase.from("offer_completions").insert({
    user_id: user.id,
    telegram_id,
    offer_id,
    reward: 1,
    status: "approved"
  });

  await supabase
    .from("users")
    .update({ balance: user.balance + 1 })
    .eq("id", user.id);

  await supabase.from("balance_logs").insert({
    user_id: user.id,
    telegram_id,
    amount: 1,
    type: "credit",
    reason: "offer_install"
  });

  alert("‚úÖ 1 Coin Added Successfully");
}
</script>
<!-- üîº YAHAN TAK -->

</body>
</html>
